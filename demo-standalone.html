<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARBITRAGE™ — AI Profit Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
        }
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body class="bg-black text-white">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 backdrop-blur-xl bg-black/80 border-b border-white/10">
        <div class="max-w-7xl mx-auto px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-emerald-400 to-cyan-400 rounded-lg flex items-center justify-center">
                        <span class="text-black text-xl font-black">A</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-black">ARBITRAGE<span class="text-emerald-400">™</span></h1>
                        <p class="text-xs text-gray-500">AI Profit Engine</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 px-3 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/30">
                    <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
                    <span class="text-xs text-emerald-400">LIVE</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-8 max-w-7xl mx-auto">
        <!-- Stats -->
        <div class="mb-12">
            <h2 class="text-sm uppercase text-gray-500 mb-4">Performance Metrics</h2>
            <div class="grid grid-cols-4 gap-4">
                <div class="bg-white/5 backdrop-blur rounded-lg p-6 border border-white/10">
                    <div class="text-3xl font-bold mb-2" id="stat-opportunities">47</div>
                    <div class="text-sm text-gray-400">Opportunities</div>
                </div>
                <div class="bg-white/5 backdrop-blur rounded-lg p-6 border border-white/10">
                    <div class="text-3xl font-bold mb-2" id="stat-purchases">8</div>
                    <div class="text-sm text-gray-400">Purchases</div>
                </div>
                <div class="bg-white/5 backdrop-blur rounded-lg p-6 border border-white/10">
                    <div class="text-3xl font-bold mb-2" id="stat-profit">$3,420</div>
                    <div class="text-sm text-gray-400">Profit</div>
                </div>
                <div class="bg-white/5 backdrop-blur rounded-lg p-6 border border-white/10">
                    <div class="text-3xl font-bold mb-2" id="stat-margin">34.7%</div>
                    <div class="text-sm text-gray-400">Avg Margin</div>
                </div>
            </div>
        </div>

        <!-- Opportunities -->
        <div>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-sm uppercase text-gray-500">Live Opportunities</h2>
                <button onclick="loadOpportunities()" class="px-6 py-2 bg-emerald-500/10 hover:bg-emerald-500/20 border border-emerald-500/30 rounded-full text-sm">
                    Force Scan
                </button>
            </div>
            <div id="opportunities-list" class="space-y-3">
                <!-- Opportunities will load here -->
                <div class="text-center py-12">
                    <div class="text-gray-500">Loading opportunities...</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = 'http://localhost:3001';

        async function loadOpportunities() {
            try {
                const response = await fetch(`${API_URL}/api/opportunities?limit=20`);
                const opportunities = await response.json();

                const container = document.getElementById('opportunities-list');
                container.innerHTML = '';

                opportunities.forEach(opp => {
                    const oppDiv = document.createElement('div');
                    oppDiv.className = 'bg-white/5 backdrop-blur rounded-lg p-6 border border-white/10 hover:border-emerald-500/30 transition-all group cursor-pointer';

                    const profit = opp.estimated_profit || 0;
                    const margin = opp.profit_margin || 0;
                    const aiDecision = margin > 25 ? 'BUY' : 'WATCH';
                    const decisionColor = aiDecision === 'BUY' ? 'emerald' : 'yellow';

                    oppDiv.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h3 class="font-semibold text-lg">${opp.product_title}</h3>
                                    <span class="px-2 py-1 bg-${decisionColor}-500/10 text-${decisionColor}-400 text-xs rounded-full border border-${decisionColor}-500/30">
                                        ${aiDecision}
                                    </span>
                                </div>
                                <div class="flex items-center space-x-6 text-sm">
                                    <div class="text-gray-400">
                                        <span class="text-gray-500">Source:</span> ${opp.source_marketplace}
                                    </div>
                                    <div class="text-gray-400">
                                        <span class="text-gray-500">Category:</span> ${opp.category}
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="flex items-center space-x-4 mb-2">
                                    <div>
                                        <div class="text-xs text-gray-500">Buy</div>
                                        <div class="font-mono text-lg">$${opp.source_price.toFixed(2)}</div>
                                    </div>
                                    <div class="text-gray-600">→</div>
                                    <div>
                                        <div class="text-xs text-gray-500">Sell</div>
                                        <div class="font-mono text-lg">$${opp.target_price.toFixed(2)}</div>
                                    </div>
                                    <div class="ml-4 text-right">
                                        <div class="text-emerald-400 font-bold text-xl">+$${profit.toFixed(2)}</div>
                                        <div class="text-xs text-emerald-400/70">${margin.toFixed(1)}% margin</div>
                                    </div>
                                </div>
                                <button onclick="quickBuy('${opp.id}')" class="px-4 py-1 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-500/50 rounded text-sm opacity-0 group-hover:opacity-100 transition-opacity">
                                    Quick Buy
                                </button>
                            </div>
                        </div>
                    `;

                    container.appendChild(oppDiv);
                });

                // Update stats
                document.getElementById('stat-opportunities').textContent = opportunities.length;

            } catch (error) {
                console.error('Error loading opportunities:', error);
                document.getElementById('opportunities-list').innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <p class="mb-2">Could not connect to backend</p>
                        <p class="text-sm">Make sure the server is running on port 3001</p>
                    </div>
                `;
            }
        }

        async function quickBuy(oppId) {
            try {
                const response = await fetch(`${API_URL}/api/purchase/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ opportunity_id: oppId })
                });
                const result = await response.json();
                alert(`✅ ${result.message}`);
            } catch (error) {
                alert('❌ Could not approve purchase');
            }
        }

        // Load opportunities on page load
        loadOpportunities();

        // Auto-refresh every 30 seconds
        setInterval(loadOpportunities, 30000);
    </script>
</body>
</html>
